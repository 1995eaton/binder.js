var Binder=function(f){var k={0:'\\',8:'bs',9:'tab',12:'num',13:'enter',19:'pause',20:'caps',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',42:'printscreen',44:'printscreen',45:'insert',46:'delete',48:['0',')'],49:['1','!'],50:['2','@'],51:['3','#'],52:['4','$'],53:['5','%'],54:['6','^'],55:['7','&'],56:['8','*'],57:['9','('],96:'0',97:'1',98:'2',99:'3',100:'4',101:'5',102:'6',103:'7',104:'8',105:['9',''],106:'*',107:'+',109:'-',111:'/',144:'num',186:[';',':'],188:[',','<'],189:['-','_'],190:['.','>'],187:['=','+'],191:['/','?'],192:['`','~'],219:['[','{'],221:[']','}'],220:['\\','|'],222:[''',''']},h={},g='',r=function(b){var a,c=[b.ctrlKey?'c':'',b.altKey?'a':'',b.metaKey?'m':'',b.shiftKey?'s':''].join('').split('');k.hasOwnProperty(b.which.toString())?(a=k[b.which.toString()],Array.isArray(a)&&(c.length||c.splice(c.indexOf('s'),1),a=a[+(b.shiftKey&&!c.length)])):/^F[0-9]+$/.test(b.keyIdentifier)?a=b.keyIdentifier.toLowerCase():(a=String.fromCharCode(b.which).toLowerCase(),b.shiftKey&&!c.length&&(a=a.toUpperCase()));c=c.filter(function(a){return a});return c.length&&c.length?'<'+c.join('-')+'-'+a+'>':'string'===typeof k[b.which.toString()]?'<'+(b.shiftKey?'s-':'')+a+'>':a},l=function(b){return b.replace(/<[^>]+>/g,function(a){return a.toLowerCase()}).replace(/<([a-z]+-)+/g,function(a){return'<'+a.slice(1).split('-').sort().join('')+'-'})},m=function(b,a){g+=b;var c=!1,e=l(g),d;for(d in h){var q=l(d);if(q===e)return a.stopPropagation(),a.preventDefault(),g='',h[d]();0===q.indexOf(e)&&(c=!0)}c||(g='')},e={keypress:function(b,a){'function'===typeof b&&b(a)},keyhandle:function(b,a){return'keypress'===a?String.fromCharCode(b.which):r(b)},keydown:function(b,a){var c;if(-1!==[16,17,18,91].indexOf(a.which))return!0;if(13===a.which||a.ctrlKey||a.metaKey||a.altKey)return c=e.keyhandle(a,'keydown'),m(c,a),b(c,a);var d=!1,f=e.keypress.bind(e,function(a){d||(d=!0,c=e.keyhandle(a,'keypress'),m(c,a),b(c,a))});window.addEventListener('keypress',f,!0);window.setTimeout(function(){window.removeEventListener('keypress',f,!0);d||(c=e.keyhandle(a,'keydown'),m(c,a),b(c,a))},0)}};f=f||function(){};var n=e.keydown.bind(null,f),d=!1,p={activate:function(){d||(d=!0,window.addEventListener('keydown',n,!0))},deactivate:function(){d&&(d=!1,window.removeEventListener('keydown',n,!0))},setCallback:function(b){f=b;d&&p.deactivate();n=e.keydown.bind(null,f);d&&p.activate()},bindings:function(){return h},bind:function(b,a){'function'===typeof a&&(h[l(b)]=a)}};return p};
